{% extends 'base.html' %}
{% load static %}
{% block container %}
    <div class="container-fluid pt-4 vw-100 vh-100 bg-gray">
        <div class="card mb-4 mx-4 rounded-4 shadow-sm custom-bg-white">
            <div class="card-body">
                <div class="cover-photo"
                        {% if school.profile_photo %}
                     style="background-image: url('{{ school.profile_photo.url }}');"
                        {% endif %}
                >
                </div>

                <div class="profile-photo"
                        {% if school.logo %}
                     style="background-image: url('{{ school.logo.url }}');"
                        {% else %}
                     style="background-image: url('{% static 'img/profile_default.png' %}');"
                        {% endif %}
                ></div>
            </div>

            <div class="row d-flex w-100 ms-0 rounded-bottom">
                <div class="col-3 flap">
                    <button hx-get="{% url 'school:general_information' school.id %}" hx-target="#section"
                            hx-swap="innerHTML" class="flap-button-left">
                        Información general
                    </button>
                </div>

                <div class="col-3 flap">
                    <button hx-get="{% url 'comments:comments_list' school.id %}" hx-target="#section"
                            hx-swap="innerHTML" class="flap-button">
                        Opiniones
                    </button>
                </div>

                <div class="col-3 flap">
                    <button hx-get="{% url 'school:careers_list' school.id %}" hx-target="#section"
                            hx-swap="innerHTML" class="flap-button">
                        Carreras
                    </button>
                </div>

                <div class="col-3 flap">
                    <button hx-get="{% url 'school:photos_list' school.id %}" hx-target="#section"
                            hx-swap="innerHTML" class="flap-button-right">
                        Fotos
                    </button>
                </div>
            </div>
        </div>

        <div class="mb-3 ms-4">
            <a href="{% url 'home' %}">Volver al listado de escuelas</a>
        </div>

        <div class="mx-4">
            <div class="row">
                <div class="col-md-8" id="section">
                    {% include 'school/partial/general_information.html' %}
                </div>
                <div class="col-md-4">
                    <div id="map"
                         data-lat="{{ school.latitude }}"
                         data-lng="{{ school.longitude }}"
                         data-name="{{ school.name|escapejs }}"
                         data-address="{{ school.address|escapejs }}"
                         style="width:100%;height:380px;border-radius:8px;background:#f0f0f0;"></div>
                    {% if not school.latitude or not school.longitude %}
                        <p class="text-muted small mt-2">Si no hay coordenadas, se geocodificará la dirección para ubicar la escuela.</p>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block js %}
    <script src="{% static 'js/location_filter.js' %}"></script>
    <script src="/static/js/replyBox.js"></script>
    <script src="{% static 'js/school_detail_map.js' %}"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initSchoolDetailMap" async defer></script>
{% endblock %}